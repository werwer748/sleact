/*! For license information please see 94.js.LICENSE.txt */
"use strict";(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[94],{3094:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var n=r(7294),a=r(1053);const l=(0,a.Z)("div",{target:"enpw7kx2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),c=(0,a.Z)("header",{target:"enpw7kx1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});var s=r(6182),o=r.n(s),i=r(8100),u=r(4593),p=r(3564),d=r(9250),h=r(2309),m=r(2545),g=r(8678),f=r(8648),w=r(8667),x=r(2951);const k=()=>{const{workspace:e,id:t}=(0,d.UO)(),{data:r,mutate:a}=(0,i.ZP)(`/api/workspaces/${e}/users/${t}`,p.Z),{data:s}=(0,i.ZP)("/api/users",p.Z),{data:k,mutate:Z,setSize:v}=(0,u.ZP)((r=>`/api/workspaces/${e}/dms/${t}/chats?perPage=20&page=${r+1}`),p.Z),[b]=(0,x.Z)(e),E=0===k?.[0]?.length,S=E||k&&k[k.length-1]?.length<20||!1,[C,$,y]=(0,g.Z)(""),T=(0,n.useRef)(null),B=(0,n.useCallback)((n=>{if(n.preventDefault(),C?.trim()&&k){const n=C;Z((e=>{const t=e?[...e]:[];return 0!==t.length&&(t[0]=[...t[0],{id:(k[0][0]?.id||0)+1,content:n,SenderId:s.id,Sender:s,ReceiverId:r.id,Receiver:r,createdAt:new Date}]),t}),!1).then((()=>{y(""),T.current?.scrollToBottom()})),f.Z.post(`/api/workspaces/${e}/dms/${t}/chats`,{content:C}).then((e=>{console.log("채팅 성공값",e),Z()})).catch(console.error)}y("")}),[C,k,s,r,e,t]),P=(0,n.useCallback)((e=>{e.SenderId===Number(t)&&s.id!==Number(t)&&Z((t=>(t?.[0].unshift(e),t)),!1).then((()=>{T.current&&T.current.getScrollHeight()<T.current.getClientHeight()+T.current.getScrollTop()+150&&(console.log("scrollToBottom!!!!",T.current?.getValues()),setTimeout((()=>{T.current?.scrollToBottom()}),50))}))}),[]);if((0,n.useEffect)((()=>(b?.on("dm",P),()=>{b?.off("dm",P)})),[b,P]),(0,n.useEffect)((()=>{1===k?.length&&T.current?.scrollToBottom()}),[k]),!r||!s)return null;const R=(0,w.Z)(k?k.flat().reverse():[]);return n.createElement(l,null,n.createElement(c,null,n.createElement("img",{src:o().url(r.email,{s:"24px",d:"retro"}),alt:r.nickname})),n.createElement(m.Z,{chatSections:R,ref:T,setSize:v,isEmpty:E,isReachingEnd:S}),n.createElement(h.Z,{chat:C,onChangeChat:$,onSubmitForm:B}))}}}]);