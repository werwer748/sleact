/*! For license information please see 708.js.LICENSE.txt */
"use strict";(self.webpackChunkalecture=self.webpackChunkalecture||[]).push([[708],{5256:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var n=a(7294),l=a(1053);const r=(0,l.Z)("div",{target:"enhg4lt2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),s=(0,l.Z)("header",{target:"enhg4lt1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"});var c=a(2545),o=a(2309),i=a(8678),h=a(9250),u=a(8100),d=a(3564),p=a(4593),g=a(2951),m=a(8648),f=a(8667),w=a(2219);const b=()=>{const{workspace:e,channel:t}=(0,h.UO)(),{data:a}=(0,u.ZP)("/api/users",d.Z),{data:l,mutate:b,setSize:Z}=(0,p.ZP)((a=>`/api/workspaces/${e}/channels/${t}/chats?perPage=20&page=${a+1}`),d.Z),{data:k}=(0,u.ZP)(`/api/workspaces/${e}/channels/${t}`,d.Z),{data:x}=(0,u.ZP)(a?`/api/workspaces/${e}/channels/${t}/members`:null,d.Z),[C]=(0,g.Z)(e),v=0===l?.[0]?.length,E=v||l&&l[l.length-1]?.length<20||!1,[_,y,$]=(0,i.Z)(""),S=(0,n.useRef)(null),[T,P]=(0,n.useState)(!1),B=(0,n.useCallback)((n=>{if(n.preventDefault(),_?.trim()&&l&&k){const n=_;b((e=>{const t=e?[...e]:[];return 0!==t.length&&(t[0]=[...t[0],{id:(l[0][0]?.id||0)+1,content:n,UserId:a.id,User:a,ChannelId:k.id,Channel:k,createdAt:new Date}]),t}),!1).then((()=>{$(""),S.current?.scrollToBottom()})),m.Z.post(`/api/workspaces/${e}/channels/${t}/chats`,{content:_}).then((e=>{console.log("채팅 성공값",e),b()})).catch(console.error)}$("")}),[_,l,a,k,e,t]),I=(0,n.useCallback)((e=>{e.Channel.name===t&&e.UserId!==a.id&&b((t=>(t?.[0].unshift(e),t)),!1).then((()=>{S.current&&S.current.getScrollHeight()<S.current.getClientHeight()+S.current.getScrollTop()+150&&(console.log("scrollToBottom!!!!",S.current?.getValues()),setTimeout((()=>{S.current?.scrollToBottom()}),50))}))}),[t,a]);(0,n.useEffect)((()=>(C?.on("message",I),()=>{C?.off("message",I)})),[C,I]),(0,n.useEffect)((()=>{1===l?.length&&S.current?.scrollToBottom()}),[l]);const U=(0,n.useCallback)((()=>{P(!0)}),[]),z=(0,n.useCallback)((()=>{P(!1)}),[]);if(!a||!a)return null;const N=(0,f.Z)(l?l.flat().reverse():[]);return n.createElement(r,null,n.createElement(s,null,n.createElement("span",null,"#",t),n.createElement("div",{className:"header-right"},n.createElement("span",null,x?.length),n.createElement("button",{onClick:U,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},n.createElement("i",{className:"c-icon p-ia__view_header__button_icon c--icon--add-user","aria-hidden":"true"})))),n.createElement(c.Z,{chatSections:N,ref:S,setSize:Z,isEmpty:v,isReachingEnd:E}),n.createElement(o.Z,{chat:_,onChangeChat:y,onSubmitForm:B}),n.createElement(w.Z,{show:T,onCloseModal:z,setShowInviteChannelModal:P}))}}}]);